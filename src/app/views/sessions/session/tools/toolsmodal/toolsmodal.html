<button class="btn btn-info min-width-button" (click)="openToolsModal()">Tools</button>

<template #toolsModalTemplate let-close="close">

  <div class="modal-header">
    <div class="col-md-1">
      <h4>Tools</h4>
    </div>
    <div class="col-md-10" style="text-align: center">
      <h5 *ngIf="!selectedTool">No tool selected</h5>

      <ch-tool-title *ngIf="selectedTool"
                     [module]="selectedModule.name"
                     [category]="selectedCategory.name"
                     [tool]="selectedTool.name.displayName">
      </ch-tool-title>
    </div>
    <div class="col-md-1" style="padding-right: 0">
      <button type="button" class="close pull-right" (click)="close(false)"><i class="fa fa-times"></i></button>
    </div>
  </div>

  <div class="modal-body">

    <!--&lt;!&ndash; module buttons &ndash;&gt;-->
    <div class="row">
      <div class="col">
        <button type="button" class="btn btn-sm module-button"
                (click)="selectModule(module)"
                *ngFor="let module of modules | modulepipe:searchTool"
                [ngClass]="{'btn-primary':module === selectedModule,
                'btn-secondary':module !== selectedModule}">{{module.name}}
        </button>
      </div>
      <div class="col">
        <div class="search-div pull-right">
          <input class="form-control" type="text" [(ngModel)]="searchTool"
                 [placeholder]="'Search tool'" (keyup)="toolSearchKeyEvent($event)">
        </div>
      </div>
    </div>

    <!--&lt;!&ndash; category and tool lists &ndash;&gt;-->
    <div class="row">
      <div class="col"><h5>Category</h5></div>
      <div class="col"><h5>Tool</h5></div>
    </div>

    <div class="row">

      <div class="col-6">
        <div class="btn-group-vertical tool-list">
          <button type="button" class="btn btn-secondary"
                  [ngClass]="{'active':category===selectedCategory}"
                  (click)="selectCategory(category)"
                  *ngFor="let category of selectedModule.categories | categorypipe: searchTool">
            <ch-tool-list-item [color]="category.color" [categoryname]="category.name"></ch-tool-list-item>
          </button>
        </div>
      </div>

      <div class="col-6">
        <div class="btn-group-vertical tool-list" *ngIf="selectedCategory">
          <button type="button"
                  class="btn btn-secondary"
                  [ngClass]="{'active':tool===selectedTool}"
                  (click)="selectTool(tool)"
                  *ngFor="let tool of selectedCategory.tools | toolpipe:searchTool"
                  id="tool-button-{{tool.id}}">
            {{tool.name.displayName}}
          </button>
        </div>
      </div>
    </div>

    <div class="row" *ngIf="selectedTool">
      <div class="col">
        <p>{{selectedTool.description}}</p>
        <div class="btn-group-vertical">
          <ch-sourcemodal
            [selectedTool]="selectedTool"
            [category]="selectedCategory.name"
            [module]="selectedModule.name"></ch-sourcemodal>
        </div>
      </div>

    </div>


    <!-- inputs -->
    <div class="row">
      <div class="col-md-7 no-padding-right">
        <h5>Input datasets
          <button class="btn btn-info btn-xs pull-right" (click)="openInputsModal()" [disabled]="!selectedTool">Edit
            multiple inputs
          </button>
        </h5>
      </div>
    </div>

    <div class="row">
      <div class="col-md-7 no-padding-right">
        <table class="table table-borderless table-condensed table-hover">
          <template *ngFor="let inputBinding of inputBindings">
            <tr *ngIf="inputBindings.length > 0"
                (mouseover)="setInputDescription(inputBinding.toolInput.description )"
                (mouseleave)="setInputDescription('')">

              <td>{{inputBinding.toolInput.name.displayName || inputBinding.toolInput.name.id}}</td>

              <td>

                <!-- ng-options allows values to be objects instead of simple strings, which makes
                it easier to get the both dataset id and name later -->
                <span *ngIf="inputBinding.datasets.length > 1">multiple </span>

                <select *ngIf="inputBinding.datasets.length <= 1"
                        [(ngModel)]="inputBinding.datasets[0]"
                        name="input_{{index}}">
                  <!--ng-required="!inputBinding.toolInput.optional"-->
                  <option
                    *ngFor="let dataset of toolService.getCompatibleDatasets(inputBinding.toolInput, selectedDatasets); trackBy: dataset.datasetId"
                    [value]="dataset.name"></option>
                </select>

                <label class="label label-warning"
                >Required input</label>
                <!--*ngIf="paramForm['input_{{index}}'].$error.required"-->
              </td>
            </tr>
          </template>
        </table>
      </div>

      <!-- input description -->
      <div class="col-md-5">
        <p>{{inputDescription}}</p>
      </div>

    </div>


    <!-- parameters -->
    <div class="row">
      <div class="col-md-12">
        <h5>Parameters</h5>
      </div>
    </div>

    <div class="row">
      <div class="col-md-7 scrollable no-padding-right">
        <ch-tools-parameter-form [tool]="selectedTool"
                                 (description)="setDescription($event)"></ch-tools-parameter-form>
      </div>

      <div class="col-md-5">
        <p>{{parameterDescription}}</p>
      </div>

    </div>
  </div>    <!--end of modal body-->
  <div class="modal-footer">
    <button class="btn btn-success min-width-button pull-right" (click)="runJob()"
            [disabled]="!isRunEnabled()">
      <span class="glyphicon glyphicon-play"></span> Run
    </button>
    <button id="close-tools-button" class="btn btn-secondary pull-right" (click)="close()">
      Close
    </button>
  </div>
</template>
