<div class="sidebar">


  <ch-session-edit-modal [sessionData]="sessionData"></ch-session-edit-modal>


  <div class="chipster-highlight ">
    <div class="bar pull-right search-div">
      <input id="dataset-search-input" type="text" [(ngModel)]="datasetSearch"
             placeholder="search dataset" (keyup)="datasetSearchKeyEvent($event)">
      <button class="clear-search-button no-border" *ngIf="datasetSearch"
              (click)="datasetSearch = null">
        <span class="glyphicon glyphicon-remove"></span>
      </button>
    </div>

    <div>

      <ngb-tabset>

        <ngb-tab index="0" title="Workflow">
          <template ngbTabContent>
            <div class="workflow-dataset-static-panel">
              <div class="add-dataset-button">
                <!--<button class="btn btn-sm btn-success link-btn"
                        (click)="openAddDatasetModal()">
                  <span class="glyphicon glyphicon-plus"></span>
                  Add dataset
                </button>-->

                <ch-add-dataset-modal
                  [datasetsMap]="sessionData.datasetsMap" [sessionId]="sessionDataService.getSessionId()"
                  [oneFile]="false" [files]="[]"></ch-add-dataset-modal>
              </div>
            </div>

            <ch-workflow-graph
              [datasetsMap]="sessionData.datasetsMap"
              [jobsMap]="sessionData.jobsMap"
              [modulesMap]="sessionData.modulesMap"
              [datasetSearch]="datasetSearch"
              [zoom]="1"
              [enabled]="true"></ch-workflow-graph>
          </template>
        </ngb-tab>

        <ngb-tab index="1" title="Datasets">
          <template ngbTabContent>
            <div class="workflow-dataset-static-panel">
              <div class="add-dataset-button">
                <button class="btn btn-sm btn-success link-btn"
                        (click)="openAddDatasetModal()">
                  <span class="glyphicon glyphicon-plus"></span>
                  Add dataset
                </button>
              </div>
            </div>

            <div class="btn-group-vertical dataset-list">
              <button type="button"
                      class="btn btn-secondary"
                      ngClass="{active:isSelectedDataset(data)}"
                      (click)="toggleDatasetSelection($event, data)"
                      *ngFor="let data of getDatasetList() | datasetsearch:datasetSearch">
                {{data.name}}
              </button>
            </div>
          </template>
        </ngb-tab>

        <ngb-tab index="2" title="Details">
          <template ngbTabContent>
            <div class="row">
              <div class="col-md-12">
                <button class="btn btn-default"
                        (click)="openCopySessionModal()">
                  Copy session
                  <i class="fa fa-circle-o-notch fa-spin" style="font-size:22px"></i>
                </button>
                <button class="btn btn-default" (click)="downloadSession()">
                  Save session file
                </button>
              </div>
            </div>
            <div class="row">
              <div class="col-md-12">
                <p>Created: {{sessionData.session.created | isodate }}</p>
              </div>
            </div>
            <div class="row">
              <div class="col-md-12">
                <p>Accessed: {{sessionData.session.accessed | isodate }}</p>
              </div>
            </div>
            <div class="row">
              <div class="col-md-12">
              <textarea id="session-notes" rows="15" placeholder="Session notes"
                        (blur)="sessionDataService.updateSession(sessionData.session).subscribe()"
                        [(ngModel)]="sessionData.session.notes">
              </textarea>
              </div>
            </div>
          </template>
        </ngb-tab>
      </ngb-tabset>
    </div>

  </div>
</div>
