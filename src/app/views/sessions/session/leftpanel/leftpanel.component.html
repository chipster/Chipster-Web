<div class="sidebar">


  <h4><span (click)="renameSessionModal()">Session - {{sessionData.session.name}}</span></h4>

  <div class="chipster-highlight ">
    <div class="bar pull-right search-div">
      <input id="dataset-search-input" type="text" [(ngModel)]="datasetSearch"
             placeholder="search file" (keyup)="datasetSearchKeyEvent($event)">
      <button class="clear-search-button no-border" *ngIf="datasetSearch"
              (click)="datasetSearch = null">
        <span class="glyphicon glyphicon-remove"></span>
      </button>
    </div>

    <div>

      <ngb-tabset>

        <ngb-tab id="workflow" title="Workflow">
          <ng-template ngbTabContent>
            <div class="workflow-dataset-static-panel">
              <div class="add-dataset-button">
                <ch-add-dataset-modal
                  [datasetsMap]="sessionData.datasetsMap"
                  [sessionId]="sessionDataService.getSessionId()"></ch-add-dataset-modal>
              </div>
            </div>

            <ch-workflow-graph
              [datasetsMap]="sessionData.datasetsMap"
              [jobsMap]="sessionData.jobsMap"
              [modulesMap]="sessionData.modulesMap"
              [datasetSearch]="datasetSearch"
              [defaultScale]="1"
              [enabled]="true"></ch-workflow-graph>
          </ng-template>
        </ngb-tab>

        <ngb-tab id="datasets" title="Files">
          <ng-template ngbTabContent>
            <div class="workflow-dataset-static-panel">
              <div class="add-dataset-button">
                <ch-add-dataset-modal
                  [datasetsMap]="sessionData.datasetsMap"
                  [sessionId]="sessionDataService.getSessionId()"></ch-add-dataset-modal>
              </div>
            </div>

            <div class="dataset-list-panel">
              <div class="list-group dataset-list">
                <button type="button"
                        class="dataset-list-button list-group-item list-group-item-action"
                        [ngClass]="{active: selectionService.isSelectedDatasetById(dataset.datasetId)}"
                        (click)="toggleDatasetSelection($event, dataset)"
                        *ngFor="let dataset of getDatasetListSorted() | datasetsearch:datasetSearch">
                  {{dataset.name}}
                </button>
              </div>
            </div>
          </ng-template>
        </ngb-tab>

        <ngb-tab id="details" title="Details">
          <ng-template ngbTabContent>
            <div class="row">
              <div class="col-md-12">

                <button class="btn btn-secondary"
                        (click)="openCopySessionModal()">
                  Copy session
                  <i *ngIf="isCopying" class="fa fa-circle-o-notch fa-spin" style="font-size:22px"></i>
                </button>
                <button class="btn btn-secondary" (click)="downloadSession()">
                  Save session file
                </button>
                <button class="btn btn-secondary" (click)="saveCurrentUrlState()">Save current state url to clipboard</button>
              </div>
            </div>
            <div class="row">
              <div class="col-md-12">
                <p>Created: {{sessionData.session.created | isodate }}</p>
              </div>
            </div>
            <div class="row">
              <div class="col-md-12">
                <p>Accessed: {{sessionData.session.accessed | isodate }}</p>
              </div>
            </div>
            <div class="row">
              <div class="col-md-12">
                <h4>Shared with</h4>
                <div *ngFor="let rule of sessionData.session.rules">
                  <p>
                    <span>{{rule.username}}, </span>
                    <span>{{rule.readWrite ? 'read-write' : 'read-only' }} </span>
                    <span *ngIf="rule.sharedBy">(shared by {{rule.sharedBy}})</span>
                    <span *ngIf="!rule.sharedBy">(owner)</span>
                  </p>
                </div>
              </div>
            </div>
            <div class="row">
              <div class="col-md-12">
              <textarea id="session-notes" rows="15" placeholder="Session notes"
                        (blur)="sessionDataService.updateSession(sessionData.session).subscribe()"
                        [(ngModel)]="sessionData.session.notes">
              </textarea>
              </div>
            </div>
          </ng-template>
        </ngb-tab>
      </ngb-tabset>
    </div>

  </div>
</div>
