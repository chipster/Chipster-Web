<div class="modal-header">
  <h4 class="modal-title">Convert to Chipster format {{dataset.name}}</h4>
  <button type="button" class="close" aria-label="Close" (click)="activeModal.close()">
    <span aria-hidden="true">&times;</span>
  </button>
</div>

<div class="modal-body">

  <div *ngIf="state.isReady(); else statusTemplate">

    <div>Convert a file to a new Chipster compatible format.</div>

    <h3 class="h3-xs">Source file preview</h3>

    <div class="scrolling-wrapper" #horizontalScroll>

      <ag-grid-angular #agGrid style="width: 100%; height: 26ex;" class="ag-theme-alpine mt-2"
        [rowData]="previewRowData" [columnDefs]="columnDefs">
      </ag-grid-angular>
      <div class="float-right text-sm">
        <i class="legend-icon far fa-square identifier" aria-hidden="true"></i><span
          class="legend-text">Identifier</span>
        <i class="legend-icon far fa-square sample" aria-hidden="true"></i><span class="legend-text">Sample</span>
        <i class="legend-icon far fa-square mr-1 include" aria-hidden="true"></i><span
          class="legend-text">Include</span>
        <i class="legend-icon far fa-square exclude" aria-hidden="true"></i><span class="legend-text">Exclude</span>
      </div>

    </div>

    <!-- identifier column -->
    <h3 class="h3-xs">Identifier column</h3>
    <ch-multi-dropdown [items]="identifierItems" [multiple]="false"
      (selectionChanged)="onIdentifierSelectionChange($event)">
    </ch-multi-dropdown>
    <!-- {{selectedIdentifiers | json}} -->


    <!-- sample columns-->
    <h3 class="h3-xs">Sample columns</h3>
    <ch-multi-dropdown [items]="sampleItems" [multiple]="true" (selectionChanged)="onSampleSelectionChange($event)">
    </ch-multi-dropdown>
    <!-- {{selectedSamples |json}} -->


    <!-- other columns -->
    <h3 class="h3-xs">Other columns</h3>
    <div class="mb-2" [formGroup]="includeExcludeForm">
      Selected columns will be
      <select formControlName="includeExclude" class="form-select" (change)="onIncludeExcludeChange($event)">
        <option *ngFor="let item of includeExcludeOptions" [value]="item">
          {{item}}
        </option>
      </select>
    </div>

    <ch-multi-dropdown [items]="otherItems" [multiple]="true" (selectionChanged)="onOtherSelectionChange($event)">
    </ch-multi-dropdown>
    <!-- {{selectedOthers |json}} -->

  </div>

  <ng-template #statusTemplate>
    <ch-status [state]="state"></ch-status>
  </ng-template>

</div>

<div class="modal-footer">
  <button type="button" class="btn btn-sm btn-secondary" (click)="activeModal.close()">Close</button>
  <button type="button" class="btn btn-sm btn-success"
    [disabled]="selectedIdentifiers.length < 1 || selectedSamples.length < 1" (click)="runWrangle()">Convert</button>
</div>
