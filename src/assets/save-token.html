<html>
<head>
<script>

console.log('waiting for the sso token');

window.onmessage = function(e) {

  /* 
  Any domain can send these messages
  
  Usually we should check e.origin before doing anything, but here the check is
  deferred to the app side, because we need the app configs to do it
  */
  console.log('save a sso token from ', e.origin, e.data);

  window.localStorage.setItem('ch-auth-insecure-origin', e.origin);
  window.localStorage.setItem('ch-auth-insecure-token', e.data);

  console.log('sso token saved, report to parent', e.origin, e.source);

  e.source.postMessage('saved', e.origin);
};

</script>
</head>
<body style="margin: 0">
Save token...
</body>
</html>

